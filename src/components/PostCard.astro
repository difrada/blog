---
import { CATEGORIES, getAuthor, type CategoryId } from '../site.config';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  author: string;
  slug: string;
  tags?: string[];
  category: CategoryId;
  lang: 'en' | 'es';
  readingTime: number;
}

const { title, description, pubDate, author, slug, tags = [], category, lang, readingTime } = Astro.props;

const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

const authorData = getAuthor(author);
const catData = CATEGORIES[category];
---

<article class="post-card" data-tags={tags.join(',').toLowerCase()} data-title={title.toLowerCase()} data-category={category}>
  <div class="post-card__header">
    <h2 class="post-card__title">
      <a href={`/posts/${slug}/`}>{title}</a>
    </h2>
  </div>

  <p class="post-card__meta">
    <!-- Calendar icon -->
    <svg class="meta-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    <em>{formattedDate}</em>
    <span class="meta-separator">·</span>
    <!-- Clock icon -->
    <svg class="meta-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    <em>{readingTime} min</em>
    <span class="meta-separator">·</span>
    <!-- Person icon -->
    <svg class="meta-icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    {authorData ? (
      <a href={`/authors/${authorData.id}/`} class="author-link">{authorData.name}</a>
    ) : (
      <span>{author}</span>
    )}
  </p>

  <p class="post-card__description">{description}</p>

  <div class="post-card__footer">
    <span class="category-badge">{catData?.icon} {catData?.en || category}</span>
    <span class="lang-badge">{(lang || 'en').toUpperCase()}</span>
    {tags.map((tag) => (
      <span class="tag">{tag}</span>
    ))}
  </div>
</article>
